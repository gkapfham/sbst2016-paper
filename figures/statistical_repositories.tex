% vim: ft=tex
%!TEX root=sbst2016.tex

\begin{figure*}

  \vspace*{-.25em}

  \begin{center}

    % SECTION: Define block styles

    \tikzstyle{repository} = [rectangle, draw, thick, double, fill=gray!10, text width=7em, text centered, rounded corners, minimum height=4em]
    \tikzstyle{repository-atdg} = [rectangle, draw, thick, double, fill=gray!30, text width=7em, text centered, rounded corners, minimum height=4em]
    \tikzstyle{repository-atsp} = [rectangle, draw, thick, double, fill=gray!60, text width=7em, text centered, rounded corners, minimum height=4em]
    \tikzstyle{report-atdg} = [rectangle, draw, thick, double, fill=gray!30, text width=7em, text centered, rounded corners, minimum height=4em]
    \tikzstyle{report-atsp} = [rectangle, draw, thick, double, fill=gray!60, text width=7em, text centered, rounded corners, minimum height=4em]
    \tikzstyle{paper-atdg} = [rectangle, draw, thick, double, fill=gray!30, text width=7em, text centered, rounded corners, minimum height=4em]
    \tikzstyle{paper-atsp} = [rectangle, draw, thick, double, fill=gray!60, text width=7em, text centered, rounded corners, minimum height=4em]
    \tikzstyle{report-atdg-result} = [rectangle, draw, thick, fill=gray!30, text width=7em, text centered, rounded corners, minimum height=4em]
    \tikzstyle{report-atsp-result} = [rectangle, draw, thick, fill=gray!60, text width=7em, text centered, rounded corners, minimum height=4em]
    \tikzstyle{process} = [rectangle, draw, thick, fill=gray!10, text width=7em, text centered, minimum height=4em]

    % SECTION: Define the line styles

    \tikzstyle{line} = [draw, thick, double, -stealth]
    \tikzstyle{single-line} = [draw, thick, -stealth]
    \tikzstyle{dashed-line} = [draw, thick, dashed, -stealth]

    \begin{tikzpicture}[node distance = 10em, auto]

      % SECTION: Create all of the nodes that will exist in the figure

      % REPOSITORIES
      \node [repository] (sbst-analysis) {sbst-analysis \\ \vspace*{.25em}\faCode~in \faGithubAlt};
      \node [repository-atdg, right of=sbst-analysis, yshift=4em] (atdg-analysis) {atdg-analysis \\ \vspace*{.25em} \faCode~+~\faDatabase~in \faGit};
      \node [repository-atsp, right of=sbst-analysis, yshift=-4em] (atsp-analysis) {atsp-analysis \\ \vspace*{.25em} \faCode~+~\faDatabase~in \faGit};
      \node [repository, above of=sbst-analysis, yshift=-2em] (sbst-analysis-fork-one) {sbst-analysis \\ \vspace*{.25em}\faCodeFork~in \faGithubAlt};
      \node [repository, below of=sbst-analysis, yshift=2em] (sbst-analysis-clone-one) {sbst-analysis \\ \vspace*{.25em}\faCopy~in \faGit};

      % REPORTS
      \node [report-atdg, right of=atdg-analysis] (atdg-report) {atdg-report \\ \vspace*{.25em} \faCode~+~\faEdit~in \faGit};
      \node [report-atsp, right of=atsp-analysis] (atsp-report) {atsp-report \\ \vspace*{.25em} \faCode~+~\faEdit~in \faGit};

      % COMPILERS
      \node [process, right of=sbst-analysis, xshift=20em] (markdown-compiler) {RMarkdown \\ Compiler};
      % \node [process, above of=markdown-compiler] (latex-compiler-one) {\LaTeX \\ Compiler};
      % \node [process, below of=markdown-compiler] (latex-compiler-two) {\LaTeX \\ Compiler};

      % PAPERS
      \node [paper-atdg, above of=markdown-compiler, yshift=-2em] (sbst-paper) {SBST Paper\\ \vspace*{.25em} \faCode~+~\faEdit~in \faGit};
      \node [paper-atsp, below of=markdown-compiler, yshift=2em] (ssbse-paper) {SSBSE Paper\\ \vspace*{.25em} \faCode~+~\faEdit~in \faGit};

      % REPORT RESULTS
      \node [report-atdg-result, right of=markdown-compiler, yshift=4em] (atdg-report-result)
        {atsp-report-result \\ \vspace*{.25em} \faBarChart~+~\faColumns~+~\faEdit};
      \node [report-atsp-result, right of=markdown-compiler, yshift=-4em] (atsp-report-result)
        {atsp-report-result \\ \vspace*{.25em} \faBarChart~+~\faColumns~+~\faEdit};

      % SECTION: Create all of the paths between the nodes
      \path [line] (sbst-analysis) -- (atdg-analysis);
      \path [line] (sbst-analysis) -- (atsp-analysis);
      \path [line] (atdg-analysis) -- (atdg-report);
      \path [line] (atsp-analysis) -- (atsp-report);
      \path [dashed-line] (atdg-report) -- (markdown-compiler);
      \path [dashed-line] (atsp-report) -- (markdown-compiler);
      \path [dashed-line] (markdown-compiler) -- (atdg-report-result);
      \path [dashed-line] (markdown-compiler) -- (atsp-report-result);
      \path [single-line] (sbst-analysis) -- (sbst-analysis-fork-one);
      \path [single-line] (sbst-analysis) -- (sbst-analysis-clone-one);
      \path [single-line] (atdg-report-result) -- (sbst-paper);
      \path [single-line] (atsp-report-result) -- (ssbse-paper);

      % SECTION: The legend for the meaning of all of the lines
      \path [single-line] (2,-3.5) -- (3,-3.5) node[draw=none,fill=none,font=\scriptsize,midway,below] {Fork, clone, or copy};
      \path [line] (4.5,-3.5) -- (5.5,-3.5) node[draw=none,fill=none,font=\scriptsize,midway,below] {R installation};
      \path [dashed-line] (7,-3.5) -- (8,-3.5) node[draw=none,fill=none,font=\scriptsize,midway,below] {Input or output};

      \end{tikzpicture}

    \end{center}

    \vspace*{-1.25em}

    \caption{Shared code repositories to support the analysis of data arising from experiments with search-based software testing
    tools.}~\label{fig:statistical_repositories}

    \vspace*{-1.25em}

  \end{figure*}
